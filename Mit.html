<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mitarbeiterverwaltung</title>
<style>
  /* Reset & Basis */
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background-color: #121212;
    color: #eee;
    transition: background-color 0.3s, color 0.3s;
  }
  body.light {
    background-color: #f7f7f7;
    color: #222;
  }
  header {
    background-color: #1f1f1f;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  body.light header {
    background-color: #ddd;
  }
  h1 {
    margin: 0;
  }
  button, select, input[type=text], input[type=email], input[type=file] {
    font-size: 14px;
    padding: 5px 10px;
    margin: 2px;
  }
  button {
    cursor: pointer;
  }
  button:disabled {
    cursor: not-allowed;
    opacity: 0.5;
  }
  a {
    color: #4aa3ff;
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }

  /* Login Bereich */
  #loginArea {
    background: #282828;
    padding: 10px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  body.light #loginArea {
    background: #eee;
  }
  #loginArea input {
    flex-grow: 1;
    padding: 5px;
    border-radius: 4px;
    border: 1px solid #555;
  }
  body.light #loginArea input {
    border-color: #aaa;
  }

  /* Controls */
  #controls {
    padding: 10px 20px;
    background-color: #222;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }
  body.light #controls {
    background-color: #eee;
  }
  #controls > * {
    flex: 1 1 150px;
    min-width: 150px;
  }

  /* Tabelle */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  thead {
    background-color: #333;
  }
  body.light thead {
    background-color: #ccc;
  }
  th, td {
    padding: 8px 10px;
    border: 1px solid #444;
    vertical-align: middle;
    text-align: left;
  }
  body.light th, body.light td {
    border-color: #bbb;
  }
  th.sortable {
    cursor: pointer;
    user-select: none;
    position: relative;
  }
  th.sortable .arrow {
    position: absolute;
    right: 8px;
    font-size: 10px;
  }
  th.sortable.asc .arrow::after {
    content: '‚ñ≤';
  }
  th.sortable.desc .arrow::after {
    content: '‚ñº';
  }
  td.editable {
    background-color: #1a1a1a;
  }
  body.light td.editable {
    background-color: #fafafa;
  }
  td.editable[contenteditable]:focus {
    outline: 2px solid #4aa3ff;
    background-color: #333;
  }
  body.light td.editable[contenteditable]:focus {
    background-color: #def;
  }

  /* Profilbild */
  .profile-pic {
    width: 40px;
    height: 40px;
    object-fit: cover;
    border-radius: 50%;
  }

  /* Modal */
  #detailModal {
    display: none;
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background-color: rgba(0,0,0,0.7);
    justify-content: center;
    align-items: center;
    z-index: 100;
  }
  #modalContent {
    background-color: #222;
    color: #eee;
    padding: 20px;
    border-radius: 6px;
    max-width: 320px;
    width: 90%;
    position: relative;
  }
  body.light #modalContent {
    background-color: #fff;
    color: #111;
    box-shadow: 0 0 15px #aaa;
  }
  #modalContent img {
    display: block;
    margin: 10px auto 0;
    border-radius: 50%;
    width: 100px;
  }
  .close-btn {
    position: absolute;
    top: 6px;
    right: 10px;
    background: transparent;
    border: none;
    font-size: 22px;
    color: inherit;
    cursor: pointer;
  }

  /* Pagination */
  #pagination {
    margin: 10px 20px;
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    justify-content: center;
  }
  #pagination button {
    min-width: 30px;
    border-radius: 4px;
  }
  #pagination button.active {
    background-color: #4aa3ff;
    color: white;
  }

  /* Bulk Aktionen */
  #bulkActions {
    margin: 10px 20px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  /* Responsive */
  @media (max-width: 768px) {
    table, thead, tbody, th, td, tr {
      display: block;
    }
    thead tr {
      position: absolute;
      top: -9999px;
      left: -9999px;
    }
    tr {
      margin-bottom: 10px;
      border: 1px solid #444;
      padding: 10px;
      background-color: #1f1f1f;
      border-radius: 6px;
    }
    body.light tr {
      background-color: #fafafa;
      border-color: #ccc;
    }
    td {
      border: none;
      position: relative;
      padding-left: 50%;
      text-align: left;
    }
    td::before {
      position: absolute;
      left: 10px;
      top: 8px;
      width: 45%;
      white-space: nowrap;
      font-weight: bold;
      color: #999;
      content: attr(data-label);
    }
    td.editable[contenteditable]:focus {
      outline: none;
      background-color: #444;
    }
    body.light td.editable[contenteditable]:focus {
      background-color: #def;
    }
    .profile-pic {
      margin: 0 auto 10px auto;
      display: block;
    }
    #bulkActions {
      flex-direction: column;
    }
  }

</style>
</head>
<body>

<header>
  <h1>Mitarbeiterverwaltung</h1>
  <button id="toggleModeBtn" title="Dark/Light Mode wechseln">üåô</button>
</header>

<section id="loginArea">
  <label for="loginName">Benutzername:</label>
  <input type="text" id="loginName" placeholder="Name eingeben" />
  <button id="loginBtn">Anmelden</button>
  <span id="welcomeMsg" style="margin-left:10px;"></span>
</section>

<section id="controls">
  <input type="text" id="filterInput" placeholder="Suchen..." title="Nach Name, Funktion, E-Mail filtern" />
  <select id="deptFilter" title="Nach Abteilung filtern">
    <option value="">Alle Abteilungen</option>
  </select>
  <select id="statusFilter" title="Nach Status filtern">
    <option value="">Alle Status</option>
    <option value="aktiv">Aktiv</option>
    <option value="urlaub">Urlaub</option>
    <option value="krank">Krank</option>
  </select>
  <button id="exportCSVBtn" title="Als CSV exportieren">CSV exportieren</button>
  <input type="file" id="importCSVInput" accept=".csv" title="CSV Datei importieren" />
</section>

<section id="bulkActions" style="display:none;">
  <label><input type="checkbox" id="selectAll"/> Alle ausw√§hlen</label>
  <select id="bulkStatus" title="Status f√ºr ausgew√§hlte √§ndern">
    <option value="">Status √§ndern</option>
    <option value="aktiv">Aktiv</option>
    <option value="urlaub">Urlaub</option>
    <option value="krank">Krank</option>
  </select>
  <button id="bulkDeleteBtn" title="Ausgew√§hlte l√∂schen" style="background:#f44336; color:#fff;">L√∂schen</button>
</section>

<table id="employeeTable" aria-label="Mitarbeiterliste">
  <thead>
    <tr>
      <th><input type="checkbox" id="headerCheckbox" title="Alle ausw√§hlen"/></th>
      <th class="sortable" data-key="name">Name <span class="arrow"></span></th>
      <th class="sortable" data-key="funktion">Funktion <span class="arrow"></span></th>
      <th class="sortable" data-key="abteilung">Abteilung <span class="arrow"></span></th>
      <th class="sortable" data-key="email">E-Mail <span class="arrow"></span></th>
      <th class="sortable" data-key="status">Status <span class="arrow"></span></th>
      <th class="sortable" data-key="eintritt">Eintritt <span class="arrow"></span></th>
      <th>Telefon</th>
      <th>Profilbild</th>
      <th>Notizen</th>
      <th>Aktionen</th>
    </tr>
  </thead>
  <tbody>
    <!-- Dynamisch -->
  </tbody>
</table>

<div id="pagination" aria-label="Seitennavigation">
  <!-- Buttons dynamisch -->
</div>

<section style="padding:20px;">
  <h2>Neuen Mitarbeiter hinzuf√ºgen</h2>
  <form id="addForm">
    <input type="text" id="newName" placeholder="Name" required />
    <input type="text" id="newFunktion" placeholder="Funktion" required />
    <input type="text" id="newAbteilung" placeholder="Abteilung" required />
    <input type="email" id="newEmail" placeholder="E-Mail" required />
    <select id="newStatus" required>
      <option value="">Status w√§hlen</option>
      <option value="aktiv">Aktiv</option>
      <option value="urlaub">Urlaub</option>
      <option value="krank">Krank</option>
    </select>
    <input type="date" id="newEintritt" placeholder="Eintrittsdatum" required />
    <input type="text" id="newTelefon" placeholder="Telefon" />
    <input type="url" id="newProfile" placeholder="Profilbild URL (optional)" />
    <textarea id="newNotizen" placeholder="Notizen"></textarea><br/>
    <button type="submit">Hinzuf√ºgen</button>
  </form>
</section>

<!-- Modal Details -->
<div id="detailModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div id="modalContent">
    <button class="close-btn" aria-label="Schlie√üen">&times;</button>
    <h3 id="modalTitle">Mitarbeiter Details</h3>
    <div id="detailBody"></div>
  </div>
</div>

<script>
  'use strict';

  // Daten
  let employees = [
    {
      name: "Max Mustermann",
      funktion: "Entwickler",
      abteilung: "IT",
      email: "max@firma.de",
      status: "aktiv",
      eintritt: "2020-01-15",
      telefon: "0123 456789",
      profile: "",
      notizen: "Sehr engagiert",
      selected: false
    },
    {
      name: "Anna Beispiel",
      funktion: "Marketing",
      abteilung: "Marketing",
      email: "anna@firma.de",
      status: "urlaub",
      eintritt: "2018-05-23",
      telefon: "0987 654321",
      profile: "",
      notizen: "",
      selected: false
    },
    {
      name: "Lisa Schmidt",
      funktion: "Support",
      abteilung: "Kundendienst",
      email: "lisa@firma.de",
      status: "krank",
      eintritt: "2019-09-30",
      telefon: "0177 123456",
      profile: "",
      notizen: "",
      selected: false
    }
  ];

  // Pagination Variablen
  let currentPage = 1;
  const rowsPerPage = 5;

  // Sortierung
  let sortKey = null;
  let sortDir = 'asc';

  // DOM-Elemente
  const tableBody = document.querySelector("#employeeTable tbody");
  const filterInput = document.getElementById("filterInput");
  const deptFilter = document.getElementById("deptFilter");
  const statusFilter = document.getElementById("statusFilter");
  const paginationDiv = document.getElementById("pagination");
  const exportBtn = document.getElementById("exportCSVBtn");
  const importInput = document.getElementById("importCSVInput");
  const addForm = document.getElementById("addForm");
  const bulkActions = document.getElementById("bulkActions");
  const selectAllCheckbox = document.getElementById("selectAll");
  const bulkStatusSelect = document.getElementById("bulkStatus");
  const bulkDeleteBtn = document.getElementById("bulkDeleteBtn");
  const headerCheckbox = document.getElementById("headerCheckbox");
  const toggleModeBtn = document.getElementById("toggleModeBtn");
  const loginNameInput = document.getElementById("loginName");
  const loginBtn = document.getElementById("loginBtn");
  const welcomeMsg = document.getElementById("welcomeMsg");

  // Modal
  const detailModal = document.getElementById("detailModal");
  const modalContent = document.getElementById("modalContent");
  const modalBody = document.getElementById("detailBody");
  const modalCloseBtn = detailModal.querySelector(".close-btn");

  // Dark/Light Mode laden
  if(localStorage.getItem('mode') === 'light'){
    document.body.classList.add('light');
    toggleModeBtn.textContent = 'üåû';
  }

  toggleModeBtn.addEventListener('click', () => {
    document.body.classList.toggle('light');
    if(document.body.classList.contains('light')){
      toggleModeBtn.textContent = 'üåû';
      localStorage.setItem('mode', 'light');
    } else {
      toggleModeBtn.textContent = 'üåô';
      localStorage.setItem('mode', 'dark');
    }
  });

  // Login Bereich
  loginBtn.addEventListener('click', () => {
    const name = loginNameInput.value.trim();
    if(name){
      welcomeMsg.textContent = `Willkommen, ${name}!`;
      loginNameInput.value = '';
      loginNameInput.disabled = true;
      loginBtn.disabled = true;
    }
  });

  // Spalten f√ºr Abteilungsfilter sammeln
  function refreshDeptFilter(){
    const abteilungen = Array.from(new Set(employees.map(e=>e.abteilung))).sort();
    deptFilter.innerHTML = '<option value="">Alle Abteilungen</option>';
    abteilungen.forEach(dep=>{
      const opt = document.createElement('option');
      opt.value = dep;
      opt.textContent = dep;
      deptFilter.appendChild(opt);
    });
  }

  // Filter und Sortieren und Paginate
  function filterSortPaginate(){
    let filtered = employees.filter(emp => {
      const fText = filterInput.value.toLowerCase();
      if(fText){
        if(!(emp.name.toLowerCase().includes(fText) ||
             emp.funktion.toLowerCase().includes(fText) ||
             emp.email.toLowerCase().includes(fText))){
          return false;
        }
      }
      if(deptFilter.value && emp.abteilung !== deptFilter.value) return false;
      if(statusFilter.value && emp.status !== statusFilter.value) return false;
      return true;
    });

    // Sortieren
    if(sortKey){
      filtered.sort((a,b)=>{
        let vA = a[sortKey] || '';
        let vB = b[sortKey] || '';
        if(sortKey === 'eintritt'){
          vA = new Date(vA);
          vB = new Date(vB);
        } else {
          vA = vA.toString().toLowerCase();
          vB = vB.toString().toLowerCase();
        }
        if(vA < vB) return sortDir === 'asc' ? -1 : 1;
        if(vA > vB) return sortDir === 'asc' ? 1 : -1;
        return 0;
      });
    }

    const totalPages = Math.ceil(filtered.length / rowsPerPage);
    if(currentPage > totalPages) currentPage = totalPages || 1;

    const start = (currentPage -1)*rowsPerPage;
    const pageItems = filtered.slice(start, start + rowsPerPage);

    renderTable(pageItems);
    renderPagination(totalPages);
    toggleBulkActions();
  }

  // Tabelle rendern
  function renderTable(data){
    tableBody.innerHTML = '';
    data.forEach((emp, i) => {
      const tr = document.createElement('tr');

      // Checkbox
      const tdSelect = document.createElement('td');
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = emp.selected || false;
      checkbox.addEventListener('change', () => {
        emp.selected = checkbox.checked;
        toggleBulkActions();
        updateHeaderCheckbox();
      });
      tdSelect.appendChild(checkbox);
      tdSelect.setAttribute('data-label', 'Ausw√§hlen');
      tr.appendChild(tdSelect);

      // Name (editable)
      const tdName = document.createElement('td');
      tdName.classList.add('editable');
      tdName.contentEditable = true;
      tdName.spellcheck = false;
      tdName.textContent = emp.name;
      tdName.setAttribute('data-label', 'Name');
      tdName.addEventListener('blur', () => {
        if(tdName.textContent.trim()){
          emp.name = tdName.textContent.trim();
          refreshDeptFilter();
          filterSortPaginate();
        } else {
          tdName.textContent = emp.name; // R√ºcksetzen
        }
      });
      tr.appendChild(tdName);

      // Funktion (editable)
      const tdFunktion = document.createElement('td');
      tdFunktion.classList.add('editable');
      tdFunktion.contentEditable = true;
      tdFunktion.spellcheck = false;
      tdFunktion.textContent = emp.funktion;
      tdFunktion.setAttribute('data-label', 'Funktion');
      tdFunktion.addEventListener('blur', () => {
        if(tdFunktion.textContent.trim()){
          emp.funktion = tdFunktion.textContent.trim();
          filterSortPaginate();
        } else {
          tdFunktion.textContent = emp.funktion;
        }
      });
      tr.appendChild(tdFunktion);

      // Abteilung (editable)
      const tdAbteilung = document.createElement('td');
      tdAbteilung.classList.add('editable');
      tdAbteilung.contentEditable = true;
      tdAbteilung.spellcheck = false;
      tdAbteilung.textContent = emp.abteilung;
      tdAbteilung.setAttribute('data-label', 'Abteilung');
      tdAbteilung.addEventListener('blur', () => {
        if(tdAbteilung.textContent.trim()){
          emp.abteilung = tdAbteilung.textContent.trim();
          refreshDeptFilter();
          filterSortPaginate();
        } else {
          tdAbteilung.textContent = emp.abteilung;
        }
      });
      tr.appendChild(tdAbteilung);

      // Email (editable, validieren)
      const tdEmail = document.createElement('td');
      tdEmail.classList.add('editable');
      tdEmail.contentEditable = true;
      tdEmail.spellcheck = false;
      tdEmail.textContent = emp.email;
      tdEmail.setAttribute('data-label', 'E-Mail');
      tdEmail.addEventListener('blur', () => {
        const val = tdEmail.textContent.trim();
        if(validateEmail(val)){
          emp.email = val;
          filterSortPaginate();
          tdEmail.style.backgroundColor = '';
        } else {
          tdEmail.style.backgroundColor = '#f44336a1';
        }
      });
      tr.appendChild(tdEmail);

      // Status (editable via select)
      const tdStatus = document.createElement('td');
      tdStatus.setAttribute('data-label', 'Status');
      const selectStatus = document.createElement('select');
      ['aktiv','urlaub','krank'].forEach(s=>{
        const opt = document.createElement('option');
        opt.value = s;
        opt.textContent = s.charAt(0).toUpperCase() + s.slice(1);
        if(emp.status === s) opt.selected = true;
        selectStatus.appendChild(opt);
      });
      selectStatus.addEventListener('change', () => {
        emp.status = selectStatus.value;
        filterSortPaginate();
      });
      tdStatus.appendChild(selectStatus);
      tr.appendChild(tdStatus);

      // Eintritt (editable)
      const tdEintritt = document.createElement('td');
      tdEintritt.classList.add('editable');
      tdEintritt.contentEditable = true;
      tdEintritt.spellcheck = false;
      tdEintritt.textContent = emp.eintritt;
      tdEintritt.setAttribute('data-label', 'Eintritt');
      tdEintritt.addEventListener('blur', () => {
        if(validateDate(tdEintritt.textContent.trim())){
          emp.eintritt = tdEintritt.textContent.trim();
          filterSortPaginate();
          tdEintritt.style.backgroundColor = '';
        } else {
          tdEintritt.style.backgroundColor = '#f44336a1';
        }
      });
      tr.appendChild(tdEintritt);

      // Telefon (editable)
      const tdTelefon = document.createElement('td');
      tdTelefon.classList.add('editable');
      tdTelefon.contentEditable = true;
      tdTelefon.spellcheck = false;
      tdTelefon.textContent = emp.telefon;
      tdTelefon.setAttribute('data-label', 'Telefon');
      tdTelefon.addEventListener('blur', () => {
        emp.telefon = tdTelefon.textContent.trim();
      });
      tr.appendChild(tdTelefon);

      // Notizen (editable)
      const tdNotizen = document.createElement('td');
      tdNotizen.classList.add('editable');
      tdNotizen.contentEditable = true;
      tdNotizen.spellcheck = false;
      tdNotizen.textContent = emp.notizen;
      tdNotizen.setAttribute('data-label', 'Notizen');
      tdNotizen.addEventListener('blur', () => {
        emp.notizen = tdNotizen.textContent.trim();
      });
      tr.appendChild(tdNotizen);

      // Aktionen (Details anzeigen)
      const tdAktionen = document.createElement('td');
      const detailBtn = document.createElement('button');
      detailBtn.textContent = "Details";
      detailBtn.addEventListener('click', () => {
        showDetailModal(emp);
      });
      tdAktionen.appendChild(detailBtn);
      tr.appendChild(tdAktionen);

      tableBody.appendChild(tr);
    });
  }

  // Validierung E-Mail
  function validateEmail(email){
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
  }

  // Validierung Datum (YYYY-MM-DD)
  function validateDate(date){
    const re = /^\d{4}-\d{2}-\d{2}$/;
    if(!re.test(date)) return false;
    const d = new Date(date);
    return !isNaN(d.getTime());
  }

  // Pagination rendern
  function renderPagination(totalPages){
    paginationDiv.innerHTML = '';
    if(totalPages <= 1) return;

    const prevBtn = document.createElement('button');
    prevBtn.textContent = "¬´";
    prevBtn.disabled = currentPage === 1;
    prevBtn.addEventListener('click', () => {
      if(currentPage > 1){
        currentPage--;
        filterSortPaginate();
      }
    });
    paginationDiv.appendChild(prevBtn);

    for(let i=1; i<=totalPages; i++){
      const pageBtn = document.createElement('button');
      pageBtn.textContent = i;
      if(i === currentPage) pageBtn.classList.add('active');
      pageBtn.addEventListener('click', () => {
        currentPage = i;
        filterSortPaginate();
      });
      paginationDiv.appendChild(pageBtn);
    }

    const nextBtn = document.createElement('button');
    nextBtn.textContent = "¬ª";
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.addEventListener('click', () => {
      if(currentPage < totalPages){
        currentPage++;
        filterSortPaginate();
      }
    });
    paginationDiv.appendChild(nextBtn);
  }

  // Bulk Actions anzeigen/verstecken
  function toggleBulkActions(){
    const anySelected = employees.some(e => e.selected);
    bulkActions.style.display = anySelected ? 'block' : 'none';
  }

  // Alle Checkboxen ausw√§hlen/deselektieren
  selectAllCheckbox.addEventListener('change', () => {
    const checked = selectAllCheckbox.checked;
    employees.forEach(e => e.selected = checked);
    filterSortPaginate();
  });

  // Header Checkbox (f√ºr alle in der aktuellen Seite)
  function updateHeaderCheckbox(){
    const filtered = employees.filter(emp => {
      if(filterInput.value){
        if(!(emp.name.toLowerCase().includes(filterInput.value.toLowerCase()) ||
             emp.funktion.toLowerCase().includes(filterInput.value.toLowerCase()) ||
             emp.email.toLowerCase().includes(filterInput.value.toLowerCase()))){
          return false;
        }
      }
      if(deptFilter.value && emp.abteilung !== deptFilter.value) return false;
      if(statusFilter.value && emp.status !== statusFilter.value) return false;
      return true;
    });

    const start = (currentPage -1)*rowsPerPage;
    const pageItems = filtered.slice(start, start + rowsPerPage);

    const allChecked = pageItems.every(e => e.selected);
    headerCheckbox.checked = allChecked;
  }

  // Bulk Status √§ndern
  bulkStatusSelect.addEventListener('change', () => {
    const status = bulkStatusSelect.value;
    if(status){
      employees.forEach(e => {
        if(e.selected){
          e.status = status;
          e.selected = false;
        }
      });
      bulkStatusSelect.value = '';
      filterSortPaginate();
    }
  });

  // Bulk l√∂schen
  bulkDeleteBtn.addEventListener('click', () => {
    for(let i = employees.length -1; i>=0; i--){
      if(employees[i].selected){
        employees.splice(i,1);
      }
    }
    filterSortPaginate();
  });

  // CSV Export
  exportBtn.addEventListener('click', () => {
    let csvContent = "data:text/csv;charset=utf-8,";
    csvContent += "Name,Funktion,Abteilung,E-Mail,Status,Eintritt,Telefon,Notizen\n";
    employees.forEach(emp => {
      const row = [
        `"${emp.name.replace(/"/g, '""')}"`,
        `"${emp.funktion.replace(/"/g, '""')}"`,
        `"${emp.abteilung.replace(/"/g, '""')}"`,
        `"${emp.email.replace(/"/g, '""')}"`,
        `"${emp.status}"`,
        `"${emp.eintritt}"`,
        `"${emp.telefon.replace(/"/g, '""')}"`,
        `"${emp.notizen.replace(/"/g, '""')}"`
      ].join(',');
      csvContent += row + "\n";
    });
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "mitarbeiter.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  });

  // CSV Import
  importInput.addEventListener('change', (event) => {
    const file = event.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
      const text = e.target.result;
      const lines = text.split(/\r?\n/);
      if(lines.length < 2) return;
      const headers = lines[0].split(',');
      for(let i=1; i<lines.length; i++){
        if(!lines[i].trim()) continue;
        const values = parseCSVLine(lines[i]);
        if(values.length !== headers.length) continue;
        const emp = {
          name: values[0].replace(/(^"|"$)/g, ''),
          funktion: values[1].replace(/(^"|"$)/g, ''),
          abteilung: values[2].replace(/(^"|"$)/g, ''),
          email: values[3].replace(/(^"|"$)/g, ''),
          status: values[4].replace(/(^"|"$)/g, ''),
          eintritt: values[5].replace(/(^"|"$)/g, ''),
          telefon: values[6].replace(/(^"|"$)/g, ''),
          notizen: values[7].replace(/(^"|"$)/g, ''),
          selected: false
        };
        employees.push(emp);
      }
      refreshDeptFilter();
      filterSortPaginate();
      importInput.value = '';
    };
    reader.readAsText(file);
  });

  // CSV Zeile parsen (Ber√ºcksichtigt ""-Einschl√ºsse)
  function parseCSVLine(line){
    const result = [];
    let current = '';
    let inQuotes = false;
    for(let i=0; i<line.length; i++){
      const char = line[i];
      if(char === '"' && (i === 0 || line[i-1] !== '\\')){
        inQuotes = !inQuotes;
      } else if(char === ',' && !inQuotes){
        result.push(current);
        current = '';
      } else {
        current += char;
      }
    }
    result.push(current);
    return result;
  }

  // Details Modal anzeigen
  function showDetailModal(emp){
    modalBody.innerHTML = `
      <p><strong>Name:</strong> ${emp.name}</p>
      <p><strong>Funktion:</strong> ${emp.funktion}</p>
      <p><strong>Abteilung:</strong> ${emp.abteilung}</p>
      <p><strong>E-Mail:</strong> ${emp.email}</p>
      <p><strong>Status:</strong> ${emp.status}</p>
      <p><strong>Eintritt:</strong> ${emp.eintritt}</p>
      <p><strong>Telefon:</strong> ${emp.telefon}</p>
      <p><strong>Notizen:</strong> ${emp.notizen}</p>
    `;
    detailModal.style.display = 'block';
  }

  // Modal schlie√üen
  modalCloseBtn.addEventListener('click', () => {
    detailModal.style.display = 'none';
  });

  // Klick au√üerhalb Modal schlie√üt es
  window.addEventListener('click', (e) => {
    if(e.target === detailModal){
      detailModal.style.display = 'none';
    }
  });

  // Initial setup
  refreshDeptFilter();
  filterSortPaginate();

})();
</script>

</body>
</html>
