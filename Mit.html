<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mitarbeiterliste</title>
<style>
  body {
    background-color: #121212;
    color: #eee;
    font-family: Arial, sans-serif;
    max-width: 1000px;
    margin: auto;
    padding: 20px;
  }
  body.light {
    background-color: #f9f9f9;
    color: #222;
  }
  nav {
    text-align: center;
    margin-bottom: 15px;
  }
  nav a {
    color: #4da3ff;
    text-decoration: none;
    margin: 0 10px;
    font-weight: bold;
  }
  nav a:hover {
    text-decoration: underline;
  }
  button, input, select {
    padding: 6px 10px;
    border-radius: 5px;
    border: none;
    margin: 5px 5px 10px 0;
    font-size: 1rem;
  }
  button {
    background-color: #4da3ff;
    color: white;
    cursor: pointer;
  }
  button:hover {
    background-color: #368de3;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    border: 1px solid #555;
    padding: 8px;
    text-align: left;
    vertical-align: middle;
  }
  body.light th, body.light td {
    border-color: #aaa;
  }
  th {
    background-color: #4da3ff;
    color: white;
    cursor: pointer;
    user-select: none;
  }
  body.light th {
    background-color: #368de3;
  }
  tr:hover {
    background-color: #333;
  }
  body.light tr:hover {
    background-color: #ddd;
  }
  .status {
    padding: 4px 8px;
    border-radius: 12px;
    font-weight: bold;
    font-size: 0.85rem;
    color: white;
    text-align: center;
    width: 80px;
  }
  .status.aktiv { background-color: #4caf50; }
  .status.urlaub { background-color: #ff9800; }
  .status.krank { background-color: #f44336; }

  .profile-pic {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
    margin-right: 8px;
    vertical-align: middle;
  }
  .name-cell {
    display: flex;
    align-items: center;
  }
  .email-link {
    color: #4da3ff;
    text-decoration: none;
  }
  .email-link:hover {
    text-decoration: underline;
  }

  /* Modal Popup */
  #detailModal {
    display: none;
    position: fixed;
    top: 0; left: 0; right:0; bottom:0;
    background: rgba(0,0,0,0.8);
    justify-content: center;
    align-items: center;
    z-index: 10;
  }
  #detailModal .modal-content {
    background: #222;
    padding: 20px;
    border-radius: 8px;
    max-width: 400px;
    color: #eee;
  }
  #detailModal .modal-content.light {
    background: #fff;
    color: #222;
  }
  #detailModal .close-btn {
    float: right;
    cursor: pointer;
    font-weight: bold;
    font-size: 1.2rem;
  }

  /* Pagination */
  #pagination {
    margin-top: 15px;
    text-align: center;
  }
  #pagination button {
    margin: 0 3px;
    padding: 6px 10px;
  }
  #pagination button.active {
    background-color: #2171d9;
  }

  /* Inline editing */
  .editable {
    background-color: #333;
    padding: 2px 6px;
    border-radius: 4px;
    min-width: 50px;
  }
  body.light .editable {
    background-color: #eee;
    color: #222;
  }
</style>
</head>
<body>

<nav>
  <a href="index.html">Startseite</a>
  <a href="about.html">Über mich</a>
  <button onclick="toggleMode()">
    Dark/Light Mode
  </button>
</nav>

<h1>Mitarbeiterliste</h1>

<div>
  <label for="filterInput">Suchen:</label>
  <input type="text" id="filterInput" placeholder="Name, Funktion, Abteilung..." oninput="applyFilters()" />

  <label for="deptFilter">Abteilung:</label>
  <select id="deptFilter" onchange="applyFilters()">
    <option value="">Alle</option>
  </select>

  <button onclick="exportCSV()">CSV Export</button>
</div>

<table id="employeeTable">
  <thead>
    <tr>
      <th data-key="profile">Bild</th>
      <th data-key="name">Name &#x25B2;&#x25BC;</th>
      <th data-key="funktion">Funktion &#x25B2;&#x25BC;</th>
      <th data-key="abteilung">Abteilung &#x25B2;&#x25BC;</th>
      <th data-key="email">E-Mail &#x25B2;&#x25BC;</th>
      <th data-key="status">Status &#x25B2;&#x25BC;</th>
      <th>Aktionen</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>

<div id="pagination"></div>

<h2>Neuen Mitarbeiter hinzufügen</h2>
<form id="addForm" onsubmit="addEmployee(event)">
  <input type="text" id="newName" placeholder="Name" required />
  <input type="text" id="newFunktion" placeholder="Funktion" required />
  <input type="text" id="newAbteilung" placeholder="Abteilung" required />
  <input type="email" id="newEmail" placeholder="E-Mail" required />
  <select id="newStatus" required>
    <option value="aktiv">Aktiv</option>
    <option value="urlaub">Urlaub</option>
    <option value="krank">Krank</option>
  </select>
  <input type="url" id="newProfile" placeholder="Profilbild URL (optional)" />
  <button type="submit">Hinzufügen</button>
</form>

<!-- Modal für Details -->
<div id="detailModal" onclick="closeModal(event)">
  <div class="modal-content" id="modalContent">
    <span class="close-btn" onclick="closeModal()">×</span>
    <h2>Mitarbeiter Details</h2>
    <div id="detailBody"></div>
  </div>
</div>

<script>
  const employees = [
    {
      name: "Anna Müller",
      funktion: "Projektleiterin",
      abteilung: "Marketing",
      email: "anna.mueller@example.com",
      status: "aktiv",
      profile: "https://i.pravatar.cc/40?img=1"
    },
    {
      name: "Max Mustermann",
      funktion: "Softwareentwickler",
      abteilung: "IT",
      email: "max.mustermann@example.com",
      status: "urlaub",
      profile: "https://i.pravatar.cc/40?img=2"
    },
    {
      name: "Lisa Schmidt",
      funktion: "Designer",
      abteilung: "Marketing",
      email: "lisa.schmidt@example.com",
      status: "krank",
      profile: "https://i.pravatar.cc/40?img=3"
    },
    {
      name: "Jonas Weber",
      funktion: "Systemadministrator",
      abteilung: "IT",
      email: "jonas.weber@example.com",
      status: "aktiv",
      profile: "https://i.pravatar.cc/40?img=4"
    },
    {
      name: "Sophie Becker",
      funktion: "Support",
      abteilung: "Kundendienst",
      email: "sophie.becker@example.com",
      status: "aktiv",
      profile: ""
    }
  ];

  let currentPage = 1;
  const rowsPerPage = 5;
  let currentSort = {key: null, asc: true};

  // Load saved mode
  if(localStorage.getItem('mode') === 'light'){
    document.body.classList.add('light');
  }

  // Dropdown mit Abteilungen füllen
  function fillDeptFilter() {
    const depts = [...new Set(employees.map(e => e.abteilung))];
    const select = document.getElementById('deptFilter');
    depts.forEach(d => {
      const opt = document.createElement('option');
      opt.value = d;
      opt.textContent = d;
      select.appendChild(opt);
    });
  }

  // Tabelle rendern
  function renderTable() {
    const tbody = document.querySelector('#employeeTable tbody');
    tbody.innerHTML = '';

    let filtered = employees.filter(e => {
      const filterText = document.getElementById('filterInput').value.toLowerCase();
      const deptFilter = document.getElementById('deptFilter').value;

      if(deptFilter && e.abteilung !== deptFilter) return false;
      if(filterText){
        return e.name.toLowerCase().includes(filterText) ||
               e.funktion.toLowerCase().includes(filterText) ||
               e.abteilung.toLowerCase().includes(filterText) ||
               e.email.toLowerCase().includes(filterText);
      }
      return true;
    });

    // Sortieren
    if(currentSort.key) {
      filtered.sort((a,b) => {
        let v1 = a[currentSort.key] || '';
        let v2 = b[currentSort.key] || '';
        v1 = v1.toString().toLowerCase();
        v2 = v2.toString().toLowerCase();
        if(v1 < v2) return currentSort.asc ? -1 : 1;
        if(v1 > v2) return currentSort.asc ? 1 : -1;
        return 0;
      });
    }

    // Pagination
    const totalPages = Math.ceil(filtered.length / rowsPerPage);
    if(currentPage > totalPages) currentPage = totalPages || 1;
    const start = (currentPage -1) * rowsPerPage;
    const pageItems = filtered.slice(start, start + rowsPerPage);

    pageItems.forEach((e,i) => {
      const tr = document.createElement('tr');

      // Profilbild
      const tdPic = document.createElement('td');
      const img = document.createElement('img');
      img.className = 'profile-pic';
      img.src = e.profile || 'https://via.placeholder.com/40?text=?';
      img.alt = 'Profilbild';
      tdPic.appendChild(img);
      tr.appendChild(tdPic);

      // Name (editierbar)
      const tdName = document.createElement('td');
      tdName.className = 'name-cell';
      const spanName = document.createElement('span');
      spanName.textContent = e.name;
      spanName.contentEditable = true;
      spanName.className = 'editable';
      spanName.onblur = () => { e.name = spanName.textContent.trim(); };
      tdName.appendChild(spanName);
      tr.appendChild(tdName);

      // Funktion (editierbar)
      const tdFunc = document.createElement('td');
      const spanFunc = document.createElement('span');
      spanFunc.textContent = e.funktion;
      spanFunc.contentEditable = true;
      spanFunc.className = 'editable';
      spanFunc.onblur = () => { e.funktion = spanFunc.textContent.trim(); };
      tdFunc.appendChild(spanFunc);
      tr.appendChild(tdFunc);

      // Abteilung (editierbar)
      const tdDept = document.createElement('td');
      const spanDept = document.createElement('span');
      spanDept.textContent = e.abteilung;
      spanDept.contentEditable = true;
      spanDept.className = 'editable';
      spanDept.onblur = () => { e.abteilung = spanDept.textContent.trim(); fillDeptFilter(); applyFilters(); };
      tdDept.appendChild(spanDept);
      tr.appendChild(tdDept);

      // Email (editierbar)
      const tdEmail = document.createElement('td');
      const spanEmail = document.createElement('span');
      spanEmail.textContent = e.email;
      spanEmail.contentEditable = true;
      spanEmail.className = 'editable';
      spanEmail.onblur = () => { e.email = spanEmail.textContent.trim(); };
      tdEmail.appendChild(spanEmail);
      tr.appendChild(tdEmail);

      // Status (editierbar via dropdown)
      const tdStatus = document.createElement('td');
      const selectStatus = document.createElement('select');
      ['aktiv', 'urlaub', 'krank'].forEach(s => {
        const opt = document.createElement('option');
        opt.value = s;
        opt.textContent = s.charAt(0).toUpperCase() + s.slice(1);
        if(e.status === s) opt.selected = true;
        selectStatus.appendChild(opt);
      });
      selectStatus.onchange = () => { e.status = selectStatus.value; renderTable(); };
      tdStatus.appendChild(selectStatus);
      tr.appendChild(tdStatus);

      // Aktionen: Details + Löschen
      const tdActions = document.createElement('td');
      const btnDetails = document.createElement('button');
      btnDetails.textContent = 'Details';
      btnDetails.onclick = () => showDetails(e);
      tdActions.appendChild(btnDetails);

      const btnDelete = document.createElement('button');
      btnDelete.textContent = 'Löschen';
      btnDelete.style.backgroundColor = '#f44336';
      btnDelete.onclick = () => {
        if(confirm(`Mitarbeiter ${e.name} wirklich löschen?`)) {
          const idx = employees.indexOf(e);
          if(idx > -1) {
            employees.splice(idx,1);
            fillDeptFilter();
            applyFilters();
          }
        }
      };
      tdActions.appendChild(btnDelete);

      tr.appendChild(tdActions);

      tbody.appendChild(tr);
    });

    renderPagination(totalPages);
  }

  // Modal öffnen
  function showDetails(e){
    const modal = document.getElementById('detailModal');
    const body = document.getElementById('detailBody');
    body.innerHTML = `
      <p><strong>Name:</strong> ${e.name}</p>
      <p><strong>Funktion:</strong> ${e.funktion}</p>
      <p><strong>Abteilung:</strong> ${e.abteilung}</p>
      <p><strong>E-Mail:</strong> <a href="mailto:${e.email}">${e.email}</a></p>
      <p><strong>Status:</strong> ${e.status.charAt(0).toUpperCase() + e.status.slice(1)}</p>
      <img src="${e.profile || 'https://via.placeholder.com/100?text=?'}" alt="Profilbild" style="width:100px; border-radius: 50%; margin-top: 10px;">
    `;
    modal.style.display = 'flex';
    if(document.body.classList.contains('light')) {
      document.querySelector('#modalContent').classList.add('light');
    } else {
      document.querySelector('#modalContent').classList.remove('light');
    }
  }

  function closeModal(e){
    if(e.target.id === 'detailModal' || e.target.classList.contains('close-btn')){
      document.getElementById('detailModal').style.display = 'none';
    }
  }

  // Filter anwenden
  function applyFilters(){
    currentPage = 1;
    renderTable();
  }

  // Sortierung
  document.querySelectorAll('th[data-key]').forEach(th => {
    th.onclick = () => {
      const key = th.getAttribute('data-key');
      if(currentSort.key === key){
        currentSort.asc = !currentSort.asc;
      } else {
        currentSort.key = key;
        currentSort.asc = true;
      }
      renderTable();
    };
  });

  // Neuen Mitarbeiter hinzufügen
  function addEmployee(e){
    e.preventDefault();
    const name = document.getElementById('newName').value.trim();
    const funktion = document.getElementById('newFunktion').value.trim();
    const abteilung = document.getElementById('newAbteilung').value.trim();
    const email = document.getElementById('newEmail').value.trim();
    const status = document.getElementById('newStatus').value;
    const profile = document.getElementById('newProfile').value.trim();

    employees.push({name, funktion, abteilung, email, status, profile});
    document.getElementById('addForm').reset();
    fillDeptFilter();
    applyFilters();
  }

  // CSV Export
  function exportCSV(){
    let csv = 'Name,Funktion,Abteilung,E-Mail,Status,Profilbild\n';
    employees.forEach(e => {
      csv += `"${e.name}","${e.funktion}","${e.abteilung}","${e.email}","${e.status}","${e.profile || ''}"\n`;
    });
    const blob = new Blob([csv], {type: 'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'mitarbeiter.csv';
    a.click();
    URL.revokeObjectURL(url);
  }

  // Dark/Light Mode Umschalter
  function toggleMode(){
    document.body.classList.toggle('light');
    if(document.body.classList.contains('light')){
      localStorage.setItem('mode', 'light');
    } else {
      localStorage.removeItem('mode');
    }
    renderTable();
  }

  // Pagination rendern
  function renderPagination(totalPages){
    const container = document.getElementById('pagination');
    container.innerHTML = '';
    if(totalPages <= 1) return;

    for(let i=1; i<=totalPages; i++){
      const btn = document.createElement('button');
      btn.textContent = i;
      if(i === currentPage) btn.classList.add('active');
      btn.onclick = () => {
        currentPage = i;
        renderTable();
      };
      container.appendChild(btn);
    }
  }

  fillDeptFilter();
  renderTable();
</script>

</body>
</html>
