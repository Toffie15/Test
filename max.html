<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Link-Datenbank</title>

<style>
:root{
  --bg:#0f1115;
  --card:#1b1f2a;
  --text:#e6e6eb;
  --muted:#9aa0aa;
  --accent:#7c6cff;
  --danger:#ff5c5c;
}

*{box-sizing:border-box;}
body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--text);}
header{position:sticky;top:0;background:rgba(15,17,21,.9);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,.06);} 
.header-inner{max-width:1200px;margin:auto;padding:1rem;display:flex;gap:1rem;}
input,select,button{background:var(--card);border:1px solid rgba(255,255,255,.08);color:var(--text);padding:.6rem .8rem;border-radius:8px;}
button{cursor:pointer;} button.primary{background:var(--accent);border:none;color:#fff;} button.danger{background:var(--danger);border:none;color:#fff;}
main{max-width:1200px;margin:auto;padding:1.5rem;}
section{margin-bottom:2.5rem;}
.section-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:.8rem;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:1rem;}
.card{background:var(--card);border-radius:14px;padding:1rem;position:relative;}
.card-title{font-weight:600;color:var(--accent);} .card-desc{font-size:.9rem;color:var(--muted);} .last-used{font-size:.75rem;color:var(--muted);}
.card-menu{position:absolute;top:.6rem;right:.6rem;cursor:pointer;opacity:.7;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;}
.modal-box{background:var(--card);width:100%;max-width:420px;padding:1.5rem;border-radius:16px;}
.modal-box h3{margin-top:0;}
.row{margin-bottom:.8rem;}
</style>
</head>
<body>
<header>
  <div class="header-inner">
    <input id="search" placeholder="Suchen…" style="flex:1">
    <button onclick="exportJSON()">Export</button>
    <input type="file" id="import" hidden>
    <button onclick="document.getElementById('import').click()">Import</button>
    <button class="primary" onclick="openModal()">+ Link</button>
  </div>
</header>

<main id="content"></main>

<div class="modal" id="modal">
  <div class="modal-box">
    <h3 id="modal-title">Link</h3>
    <div class="row"><input id="m-title" placeholder="Titel" style="width:100%"></div>
    <div class="row"><input id="m-desc" placeholder="Beschreibung" style="width:100%"></div>
    <div class="row"><input id="m-url" placeholder="https://" style="width:100%"></div>
    <div class="row"><input id="m-cat" placeholder="Kategorie"></div>
    <div style="display:flex;gap:.5rem;justify-content:space-between">
      <button class="danger" id="deleteBtn" onclick="removeLink()">Löschen</button>
      <div>
        <button onclick="closeModal()">Abbrechen</button>
        <button class="primary" onclick="saveLink()">Speichern</button>
      </div>
    </div>
  </div>
</div>

<script>
let data=JSON.parse(localStorage.getItem('links')||'{}');
let editRef=null;

function persist(){localStorage.setItem('links',JSON.stringify(data));render();}

function render(){
  const wrap=document.getElementById('content');wrap.innerHTML='';
  Object.keys(data).sort().forEach(cat=>{
    const sec=document.createElement('section');
    sec.innerHTML=`<div class='section-head'><h2>${cat}</h2><span>${data[cat].length}</span></div>`;
    const g=document.createElement('div');g.className='grid';
    data[cat].forEach((l,i)=>{
      const c=document.createElement('div');c.className='card';
      c.innerHTML=`<div class='card-menu' onclick='openEdit("${cat}",${i})'>⋮</div><div class='card-title'>${l.title}</div><div class='card-desc'>${l.desc}</div><div class='last-used'>${l.last||''}</div>`;
      c.onclick=()=>{l.last=new Date().toLocaleString();persist();window.open(l.url,'_blank');};
      g.appendChild(c);
    });sec.appendChild(g);wrap.appendChild(sec);
  });
}

function openModal(){editRef=null;document.getElementById('modal-title').textContent='Neuer Link';deleteBtn.style.display='none';modal.style.display='flex';clearModal();}
function openEdit(cat,i){editRef={cat,i};const l=data[cat][i];mTitle.value=l.title;mDesc.value=l.desc;mUrl.value=l.url;mCat.value=cat;deleteBtn.style.display='inline-block';modal.style.display='flex';}
function closeModal(){modal.style.display='none';}
function clearModal(){mTitle.value=mDesc.value=mUrl.value=mCat.value='';}

function saveLink(){
  if(!mUrl.value)return;
  if(editRef){
    const {cat,i}=editRef;
    data[cat].splice(i,1);
  }
  const cat=mCat.value||'Allgemein';
  data[cat]=data[cat]||[];
  data[cat].push({title:mTitle.value||'Ohne Titel',desc:mDesc.value||'',url:mUrl.value,last:''});
  persist();closeModal();
}

function removeLink(){
  if(!editRef)return;
  const {cat,i}=editRef;
  data[cat].splice(i,1);
  if(data[cat].length===0)delete data[cat];
  persist();closeModal();
}

function exportJSON(){
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([JSON.stringify(data,null,2)],{type:'application/json'}));
  a.download='links.json';a.click();
}

import.onchange=e=>{
  const f=e.target.files[0];if(!f)return;
  const r=new FileReader();
  r.onload=()=>{data=JSON.parse(r.result);persist();};
  r.readAsText(f);
}

search.oninput=e=>{
  const v=e.target.value.toLowerCase();
  document.querySelectorAll('.card').forEach(c=>{
    c.style.display=c.innerText.toLowerCase().includes(v)?'block':'none';
  });
};

const modal=document.getElementById('modal');
const mTitle=document.getElementById('m-title');
const mDesc=document.getElementById('m-desc');
const mUrl=document.getElementById('m-url');
const mCat=document.getElementById('m-cat');
const deleteBtn=document.getElementById('deleteBtn');

render();
</script>
</body>
</html>
