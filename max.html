<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Link-Datenbank</title>
<style>
:root{
  --bg:#0b0d12;
  --panel:#141824;
  --card:#1b2033;
  --text:#e8e9ee;
  --muted:#9aa0b3;
  --accent:#7c6cff;
  --danger:#ff5c5c;
  --radius:14px;
}
*{box-sizing:border-box}
html,body{margin:0;height:100%}
body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:radial-gradient(1200px 600px at 10% -10%,#1a1f35 0%,transparent 40%),var(--bg);color:var(--text);}
header{position:sticky;top:0;z-index:10;backdrop-filter:blur(14px);background:rgba(11,13,18,.75);border-bottom:1px solid rgba(255,255,255,.06);}
.header-inner{max-width:1280px;margin:auto;padding:1rem;display:grid;grid-template-columns:1fr auto auto auto;gap:.75rem;}
input,button{background:var(--panel);border:1px solid rgba(255,255,255,.08);color:var(--text);padding:.6rem .8rem;border-radius:10px;}
input::placeholder{color:var(--muted)}
button{cursor:pointer}
button.primary{background:linear-gradient(135deg,#8b7bff,#6a5cff);border:none}
button.ghost{background:transparent}
button.danger{background:var(--danger);border:none}
main{max-width:1280px;margin:auto;padding:1.5rem 1rem 3rem;}
section{margin-bottom:2rem;}
.section-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;cursor:pointer;}
.section-head h2{margin:0;font-size:1.1rem}
.section-head span{color:var(--muted);font-size:.85rem}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:1rem;transition:max-height 0.25s ease;overflow:hidden;}
.grid.collapsed{max-height:0;}
.card{background: rgba(255,255,255,0.08);border-radius:var(--radius);padding:1rem;position:relative;transition:transform .25s ease, box-shadow .25s ease, backdrop-filter .25s ease;border:1px solid rgba(255,255,255,0.15);backdrop-filter: blur(12px) saturate(180%) brightness(1.1);}
.card:hover{transform:translateY(-6px) scale(1.02);box-shadow:0 16px 32px rgba(0,0,0,0.4);backdrop-filter: blur(18px) saturate(200%) brightness(1.15);}
.card-title{font-weight:600;color:var(--accent)}
.card-desc{font-size:.9rem;color:var(--muted)}
.card-last{font-size:.75rem;color:var(--muted);margin-top:.4rem}
.card-menu{position:absolute;top:.6rem;right:.6rem;opacity:.7;cursor:pointer}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.65);z-index:50}
.modal-box{width:100%;max-width:440px;background:var(--panel);padding:1.5rem;border-radius:20px}
.modal-box h3{margin-top:0}
.row{margin-bottom:.9rem}
.footer-actions{display:flex;justify-content:space-between;gap:.5rem}
.add-menu{position:absolute;top:100%;right:0;background:var(--panel);border:1px solid rgba(255,255,255,.1);border-radius:10px;padding:.5rem;display:none;flex-direction:column;gap:.25rem;backdrop-filter: blur(12px) saturate(180%) brightness(1.1);z-index:100;}
.add-menu button{width:100%;text-align:left;}
</style>
</head>
<body>
<header>
  <div class="header-inner">
    <input id="search" placeholder="Suchen…" />
    <button class="ghost" id="exportBtn">Export</button>
    <button class="ghost" id="importBtn">Import</button>
    <div style="position:relative;">
      <button class="primary" id="addBtn">+ Link</button>
      <div class="add-menu" id="addMenu">
        <button id="addLinkBtn">Neuer Link</button>
        <button id="addCategoryBtn">Neue Kategorie</button>
      </div>
    </div>
    <input type="file" id="importFile" hidden />
  </div>
</header>
<main id="app"></main>
<div class="modal" id="modal">
  <div class="modal-box">
    <h3 id="modalTitle">Link</h3>
    <div class="row"><input id="fTitle" placeholder="Titel" /></div>
    <div class="row"><input id="fDesc" placeholder="Beschreibung" /></div>
    <div class="row"><input id="fUrl" placeholder="https://" /></div>
    <div class="row"><input id="fCat" placeholder="Kategorie" /></div>
    <div class="footer-actions">
      <button class="danger" id="deleteBtn">Löschen</button>
      <div style="display:flex;gap:.5rem">
        <button id="cancelBtn">Abbrechen</button>
        <button class="primary" id="saveBtn">Speichern</button>
      </div>
    </div>
  </div>
</div>
<script type="module">
const $ = s => document.querySelector(s);
const app = $('#app');
let state = JSON.parse(localStorage.getItem('links') || '{}');
let editing = null;

// Add Menu Handling
const addBtn = $('#addBtn');
const addMenu = $('#addMenu');
const addLinkBtn = $('#addLinkBtn');
const addCategoryBtn = $('#addCategoryBtn');
addBtn.onclick = e => { addMenu.style.display = addMenu.style.display==='flex'?'none':'flex'; addMenu.style.flexDirection='column'; };
document.addEventListener('click', e=>{ if(!addBtn.contains(e.target) && !addMenu.contains(e.target)) addMenu.style.display='none'; });
addLinkBtn.onclick = ()=>{ openNew(); addMenu.style.display='none'; };
addCategoryBtn.onclick = ()=>{ const cat = prompt('Name der neuen Kategorie'); if(cat){ state[cat]=state[cat]||[]; save(); } addMenu.style.display='none'; };

function render(){
  app.innerHTML = '';
  Object.keys(state).sort().forEach(cat => {
    const sec = document.createElement('section');
    sec.innerHTML = `<div class='section-head'><h2>${cat}</h2><span>${state[cat].length}</span></div>`;
    const grid = document.createElement('div');
    grid.className = 'grid collapsed';

    // Sort links alphabetisch
    state[cat].sort((a,b)=>a.title.localeCompare(b.title));

    state[cat].forEach((l,i) => {
      const card = document.createElement('div');
      card.className = 'card';
      card.draggable = true;
      card.innerHTML = `<div class='card-menu'>⋮</div><div class='card-title'>${l.title}</div><div class='card-desc'>${l.desc}</div><div class='card-last'>${l.last||''}</div>`;

      card.onclick = () => { l.last=new Date().toLocaleString(); save(); window.open(l.url,'_blank'); };
      card.querySelector('.card-menu').onclick = e=>{ e.stopPropagation(); openEdit(cat,i); };

      // Drag & Drop
      card.ondragstart = e => { e.dataTransfer.setData('text/plain', JSON.stringify({cat,index:i})); };
      card.oncontextmenu = e=>{
        e.preventDefault();
        const newCat = prompt('Verschieben in Kategorie:', cat);
        if(newCat){ state[cat].splice(i,1); if(!state[newCat]) state[newCat]=[]; state[newCat].push(l); if(state[cat].length===0) delete state[cat]; save(); }
      };

      grid.appendChild(card);
    });

    // Grid Drop Handling
    grid.ondragover = e => e.preventDefault();
    grid.ondrop = e => {
      e.preventDefault();
      const dataDrop = JSON.parse(e.dataTransfer.getData('text/plain'));
      const movedLink = state[dataDrop.cat].splice(dataDrop.index, 1)[0];
      if(!state[cat]) state[cat] = [];
      state[cat].push(movedLink);
      if(state[dataDrop.cat].length===0) delete state[dataDrop.cat];
      save();
    };

    sec.appendChild(grid);
    app.appendChild(sec);

    sec.querySelector('.section-head').onclick=()=>grid.classList.toggle('collapsed');
  });
}

function save(){ localStorage.setItem('links', JSON.stringify(state)); render(); }
function openNew(){ editing=null; $('#modalTitle').textContent='Neuer Link'; $('#deleteBtn').style.display='none'; clearForm(); $('#modal').style.display='flex'; }
function openEdit(cat,i){ editing={cat,i}; const l=state[cat][i]; fTitle.value=l.title; fDesc.value=l.desc; fUrl.value=l.url; fCat.value=cat; $('#deleteBtn').style.display='inline-block'; $('#modal').style.display='flex'; }
function closeModal(){ $('#modal').style.display='none'; }
function clearForm(){ fTitle.value=fDesc.value=fUrl.value=fCat.value=''; }
function saveLink(){ if(!fUrl.value)return; if(editing){ const {cat,i}=editing; state[cat].splice(i,1); if(state[cat].length===0) delete state[cat]; } const cat=fCat.value||'Allgemein'; state[cat]=state[cat]||[]; state[cat].push({title:fTitle.value||'Ohne Titel',desc:fDesc.value||'',url:fUrl.value,last:''}); save(); closeModal(); }
function deleteLink(){ if(!editing)return; const {cat,i}=editing; state[cat].splice(i,1); if(state[cat].length===0) delete state[cat]; save(); closeModal(); }

$('#exportBtn').onclick=()=>{ const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([JSON.stringify(state,null,2)],{type:'application/json'})); a.download='links.json'; a.click(); }
$('#importBtn').onclick=()=>$('#importFile').click();
$('#importFile').onchange=e=>{ const f=e.target.files[0]; if(!f)return; const r=new FileReader(); r.onload=()=>{ state=JSON.parse(r.result); save(); }; r.readAsText(f); }
$('#search').oninput=e=>{ const v=e.target.value.toLowerCase(); document.querySelectorAll('.card').forEach(c=>c.style.display=c.innerText.toLowerCase().includes(v)?'block':'none'); }
$('#cancelBtn').onclick=closeModal; $('#saveBtn').onclick=saveLink; $('#deleteBtn').onclick=deleteLink;
render();
</script>
</body>
</html>
